---
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import BaseLayout from '../layouts/BaseLayout.astro';

// Releases data
const releases = [
  {
    version: '0.6.0',
    date: 'Feb 8, 2026',
    title: 'Fatigue Detection, Smarter Recommendations, and Session Controls',
    description: 'This release brings major improvements to session monitoring with fatigue detection, smarter recommendations, and new ways to organize your training.',
    sections: [
      {
        title: 'Session Monitoring',
        items: [
          'Fatigue detection: get alerts when your performance is declining and it\'s time for a break',
          'Session length insights with target run counts based on your goals',
          'Rename sessions and add notes to track what you\'re working on',
        ],
        image: { src: '/assets/images/fatigue.webp', alt: 'Fatigue detection alert' },
      },
      {
        title: 'Benchmarks',
        items: [
          'Explore page recommendations: toggle on to see which benchmarks you should focus on',
          'Scenario recommendations redesigned with simpler arrow indicators instead of numerical scores',
          'Top Picks highlight the best scenarios to play based on category diversity and improvement potential',
          'Add personal notes to benchmarks with preferred training sensitivity',
          'Improved info display with better category readability',
        ],
        images: [
          { src: '/assets/images/benchmark_explore_recom.webp', alt: 'Benchmark recommendations' },
          { src: '/assets/images/benchmark_overview.webp', alt: 'Benchmark progress with scenario recommendations' },
        ],
      },
      {
        title: 'UI & Customization',
        items: [
          'Font settings: choose between Montserrat, Inter, or JetBrains Mono',
          'Expandable charts across the app for a better view',
          'Search, sort, and filter for both sessions and scenarios',
          'Full-screen mouse trace viewer',
        ],
      },
      {
        title: 'Performance & Fixes',
        items: [
          'Internal code refactoring for improved performance and stability',
          'Various UI improvements and bug fixes',
        ],
      },
    ],
  },
  {
    version: '0.5.3',
    date: 'Nov 20, 2025',
    title: 'Mouse Tracking Stability',
    description: 'Fixed critical mouse tracking issues and refined the benchmark UI for a smoother experience.',
    sections: [
      {
        title: 'Changes',
        items: [
          'Mouse tracking: fixed a critical bug that could cause tracking to stop during sessions, improving stability and reliability',
          'Benchmarks: refined UI/UX for benchmark tracking and added new benchmark entries',
          'Mouse trace viewer: added replay speed control and minor UI/UX improvements',
          'Various UI improvements and bug fixes',
        ],
      },
    ],
  },
  {
    version: '0.5.2',
    date: 'Nov 11, 2025',
    title: 'Patch',
    description: 'Various UI improvements and bug fixes.',
    sections: [],
  },
  {
    version: '0.5.1',
    date: 'Nov 11, 2025',
    title: 'Improved Sensitivity Suggestions',
    description: 'Better algorithm that uses trace data to provide more accurate sensitivity recommendations, even for cases with mixed overshoot/undershoot patterns.',
    sections: [],
  },
  {
    version: '0.5.0',
    date: 'Nov 10, 2025',
    title: 'Sensitivity Suggestions and Benchmark Controls',
    description: 'Trace analysis can now show a recommended sensitivity estimate, plus new visibility controls for benchmark tables.',
    sections: [
      {
        title: 'New Features',
        items: [
          'Preview: Suggested sensitivity hints - Trace analysis can show a recommended sensitivity estimate to try',
          'Benchmarks: visibility controls for ranks and an auto-hide option make benchmark tables easier to read',
          'Performance vs Sensitivity chart: new bar chart showing how many runs fall into each sensitivity range',
          'Various UI improvements and bug fixes',
        ],
      },
    ],
  },
  {
    version: '0.4.0',
    date: 'Nov 3, 2025',
    title: 'Mouse Movement Analysis',
    description: 'Automatic detection of overshoots, undershoots, and inefficient mouse paths. Plus share your benchmark progress with one click.',
    sections: [
      {
        title: 'New Features',
        items: [
          'Preview: Mouse movement analysis - automatic detection of overshoots, undershoots, and inefficient mouse paths',
          'Share your progress: new Share button copies a polished image of your benchmark progress',
          'Mouse tracking: improved performance and stability - no longer affects sensitivity, now captures clicks',
          'New Performance vs Sensitivity chart (formerly Score vs Sensitivity) - choose Score, Accuracy or Real Avg TTK',
          'State & persistence: UI controls now persist per-page so filters and metric choices survive navigation',
          'Various UI improvements and bug fixes',
        ],
      },
    ],
  },
  {
    version: '0.3.1',
    date: 'Oct 31, 2025',
    title: 'Patch',
    description: 'Auto-update (Windows): One-click updates now work reliably.',
    sections: [],
  },
  {
    version: '0.3.0',
    date: 'Oct 30, 2025',
    title: 'Auto-Updates and Benchmark Analysis',
    description: 'One-click updates, new benchmark analysis charts, and preview features for session insights and sensitivity analysis.',
    sections: [
      {
        title: 'New Features',
        items: [
          'Auto-update (Windows): the app checks for updates on startup and lets you install with one click',
          'Benchmarks: new Analysis tab with side-by-side charts for strengths/weaknesses and rank distribution',
          'Settings: Advanced SteamID override for benchmark progress fetching',
        ],
      },
      {
        title: 'Preview Features',
        items: [
          'Sessions: Next high score forecast predicts number of runs to the next PB, with optimal pause and confidence estimate',
          'Sensitivity analysis: see Score vs Sensitivity (cm/360) in Sessions overview',
        ],
      },
    ],
  },
  {
    version: '0.2.0',
    date: 'Oct 28, 2025',
    title: 'Recommendations and Session Insights',
    description: 'Benchmark recommendations, all-time progress tracking, and session length insights.',
    sections: [
      {
        title: 'New Features',
        items: [
          'Benchmarks: new Recom column to suggest what to play next, with up/down indicator',
          'New Progress (all) tab in Sessions: see all-time progress across scenarios with trends',
          'Time-of-day chart to visualize when you train most',
          'Switch between Runs and Sessions view in the top chart and summary',
          'Session length insights: warm-up estimate and suggested runs for goals',
          'Added new preset themes: Nord, Gruvbox, and Solarized Dark',
          'Various UI improvements and bug fixes',
        ],
      },
    ],
  },
  {
    version: '0.1.1',
    date: 'Oct 28, 2025',
    title: 'Patch',
    description: 'Fix: Support & Feedback now opens in your default browser instead of the in-app webview.',
    sections: [],
  },
  {
    version: '0.1.0',
    date: 'Oct 28, 2025',
    title: 'Initial Minor Release',
    description: 'Proper versioning, updated settings system, and new features for benchmarks and scenarios.',
    sections: [
      {
        title: 'New Features',
        items: [
          'Proper app versioning (semantic version, exposed via the app API)',
          'Updated settings system with advanced options (theme, traces dir, parse-existing limit, mouse buffer)',
          'New Raw Stats tab for scenarios with smart formatting and categories',
          'Benchmark progress shown inside the Sessions view for the selected scenario',
          'Various UI improvements and bug fixes',
        ],
      },
    ],
  },
  {
    version: '0.0.0',
    date: 'Oct 25, 2025',
    title: 'Initial Release',
    description: 'The first public release of RefleK\'s with automatic stat tracking, mouse recording, and benchmark browsing.',
    sections: [
      {
        title: 'Features',
        items: [
          'Automatic tracking of KovaaK\'s stats with live updates',
          'Session grouping by time gap, with session summaries and recent sessions list',
          'Scenario analysis: events over time, accuracy trend, Real Avg TTK, moving averages, and consistency',
          'Sessions overview: score/accuracy/TTK chart, findings (best/worst runs), and scenario-mix radar',
          'Benchmarks: explore official lists, favorite benchmarks, and fetch progress via Steam (Windows)',
          'Mouse movement capture and replay (Windows), saved locally to your traces folder',
          'Launch scenarios in KovaaK\'s directly from the app',
          'Themes and a basic settings page',
        ],
      },
    ],
  },
];
---

<BaseLayout title="Changelog - RefleK's" description="See what's new in RefleK's, what we're working on, and what's coming next.">
  <Header slot="header" currentPath="/changelog" />

  <!-- Hero -->
  <section class="pt-20 pb-8 sm:pt-24 sm:pb-12">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-accent-primary font-medium text-sm mb-3">Changelog</p>
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-semibold tracking-tight text-text-primary">
        What's new in RefleK's
      </h1>
    </div>
  </section>

  <!-- Releases -->
  <section class="py-8 sm:py-12 pb-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="space-y-20 sm:space-y-24">
        {releases.map((release) => (
          <article class="grid grid-cols-1 lg:grid-cols-[260px_2fr_260px] gap-6 lg:gap-8">
            <!-- Left column: Version & Date -->
            <div class="flex lg:flex-col items-center lg:items-start gap-2 lg:gap-1 lg:pt-1">
              <div class="flex items-center gap-2">
                <span class="version-badge">{release.version}</span>
                <span class="text-sm text-text-muted whitespace-nowrap">{release.date}</span>
              </div>
            </div>

            <!-- Middle column: Content (text-left but column is centered) -->
            <div class="text-left">
              <h2 class="text-2xl sm:text-3xl font-medium text-text-primary mb-3">
                {release.title}
              </h2>
              <p class="text-text-secondary leading-relaxed mb-8">
                {release.description}
              </p>

              <!-- Sections -->
              <div class="space-y-8 mb-8">
                {release.sections.map((section) => (
                  <div>
                    <h3 class="text-base font-semibold text-text-primary mb-3">
                      {section.title}
                    </h3>
                    <ul class="space-y-2 mb-4">
                      {section.items.map((item) => (
                        <li class="flex items-baseline gap-2.5 text-text-secondary text-[15px] leading-relaxed">
                          <span class="text-text-muted text-[10px]">‚óè</span>
                          <span>{item}</span>
                        </li>
                      ))}
                    </ul>
                    {section.image && (
                      <div class="feature-image mt-4">
                        <img
                          src={section.image.src}
                          alt={section.image.alt}
                          loading="lazy"
                        />
                      </div>
                    )}
                    {section.images && section.images.length > 0 && (
                      <div class={`grid gap-4 mt-4 ${section.images.length > 1 ? 'grid-cols-1 sm:grid-cols-2' : 'grid-cols-1'}`}>
                        {section.images.map((img: { src: string; alt: string }) => (
                          <div class="feature-image">
                            <img
                              src={img.src}
                              alt={img.alt}
                              loading="lazy"
                            />
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>

            <!-- Right column: Empty (for visual balance) -->
            <div class="hidden lg:block"></div>
          </article>
        ))}
      </div>
    </div>
  </section>
  <Footer slot="footer" />
</BaseLayout>
